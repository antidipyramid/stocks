{% extends 'stocks/base.html' %}
{% load static %}
{% block content %}

<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500&display=swap" rel="stylesheet"> 
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.1.4/dist/css/datepicker-bs4.min.css">
<script src="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.1.4/dist/js/datepicker-full.min.js"></script>
<script src="{% static 'js/datejs/date-en-US.js' %}"></script>
<script src='{% static 'js/all_trades.js' %}'></script>
<script src='{% static 'js/detail_heatmap.js' %}'></script>

<div class="container-fluid content">
    <h1 class="mt-3 mb-4">{{ asset.name }} ({{ asset.ticker }})</h1>

    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button" role="tab" aria-controls="stats" aria-selected="true">Stats At-A-Glance</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="false">Trade Explorer</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="trades-tab" data-bs-toggle="tab" data-bs-target="#trades" type="button" role="tab" aria-controls="trades" aria-selected="false">All Trades</button>
      </li>
    </ul>

    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="stats" role="tabpanel" aria-labelledby="stats-tab">

        <h2 class="mt-3 text-center" style="font-family:Roboto Mono;">There are <u>{{ trades|length }}</u> trades on file for {{ asset.name }}</h2>

        <div class="d-flex" style="--bs-gutter-x:0;">
          <div class="card bg-secondary shadow-sm flex-fill" >
            <div class="card-header">Most Active Senators</div>
            <div class="card-body">
              <figure id="most-active-senators"></figure>
              <script src='{% static 'js/most_active_senators.js' %}'></script>
            </div>
          </div>
          <div class="card bg-secondary shadow-sm flex-fill" >
            <div class="card-header">Most Recent Trades</div>
            <div class="card-body">
            <table class= "table table-hover table-sm mt-3">
              <thead>
                <tr>
                  <th scope="col">Date</th>
                  <th scope="col">Senator</th>
                  <th scope="col">Owner</th>
                  <th scope="col">Ticker</th>
                  <th scope="col">Asset Type</th>
                  <th scope="col">Transaction Type</th>
                  <th scope="col">Amount</th>
                </tr>
              </thead>
              <tbody id="most-recent-trades-table">
              </tbody>
            </table>
              <script src='{% static 'js/asset_recent_trades_graph.js' %}'></script>
            </div>
          </div>
        </div>
        <div class="d-flex" style="--bs-gutter-x:0;">
          <div class="card bg-secondary shadow-sm flex-fill" >
            <div class="card-header">Buy or Sell?</div>
            <div class="card-body">
              <figure id="asset-type-graph"></figure>
              <script src='{% static 'js/asset_trans_type_graph.js' %}'></script>
            </div>
          </div>
          <div class="card bg-secondary shadow-sm flex-fill" >
            <div class="card-header">Trades by Amount</div>
            <div class="card-body">
              <figure id="asset-amount-graph"></figure>
              <script src='{% static 'js/asset_amount_graph.js' %}'></script>
            </div>
          </div>
        </div>
      </div>
      <script src='{% static 'js/asset_detail_brain.js' %}'></script>
      <div class="tab-pane fade show" id="overview" role="tabpanel" aria-labelledby="overview-tab">

        <!-- Overview tab -->	

        <!-- Asset price graph -->

        <div class="row mt-3 align-items-center">
          <div class="col">
            <figure id="heatmap"></figure>
          </div>

          <!-- Filter options -->
          <div class="col justify-content-center">
            <div class="p-3 border light contrast-box">
              <div class="form-floating mb-1">
                <select class="form-select form-select-sm" id="yearSelect" aria-label="Default select example">
                  <option selected>All</option>
                  <option value="2021">2021</option>
                  <option value="2020">2020</option>
                  <option value="2019">2019</option>
                </select>
                <label for="yearSelect">Year</label>
              </div>
              <div class="form-floating mb-1">
                <select class="form-select form-select-sm" id="senatorSelect" aria-label="Default select example">
                  <option value="All" selected>All</option>
                </select>
                <label for="senatorSelect">Senator</label>
              </div>
              <div class="form-floating mb-1">
                <select class="form-select form-select-sm" id="transaction_type" aria-label="transaction type select">
                  <option value="All" selected>All</option>
                  <option value="Purchase">Purchase</option>
                  <option value="Sale">Sale</option>
                </select>
                <label for="transaction_type">Transaction Type</label>
              </div>
              <div class="form-floating mb-1">
                <select class="form-select form-select-sm" id="amount" aria-label"trade amount select">
                  <option value="All" selected>All</option>
                  <option value="$1,001 - $15,000">$1,001 - $15,000</option>
                  <option value="$15,001 - $50,000">$15,001 - $50,000</option>              
                  <option value="$50,001 - $100,000">$50,001 - $100,000</option>
                  <option value="$100,001 - $250,000">$100,001 - $250,000</option>
                  <option value="$251,001 - $500,000">$251,001 - $500,000</option>
                  <option value="$500,001 - $1,000,000">$500,001 - $1,000,000</option>
                  <option value="$1,000,001 - 5,000,000">$1,000,001 - 5,000,000</option>
                  <option value="$5,000,001 - $25,000,000">$5,000,001 - $25,000,000</option>
                  <option value="$25,000,001 - $50,000,000">$25,000,001 - $50,000,000</option>
                  <option value="Over $50,000,0000">Over $50,000,000</option>
                </select>
                <label for="amount">Transaction Amount</label>
              </div>
              <div class="d-grid">
                <button onclick="clearTradesFilterForms()" type="button" class="btn btn-sm btn-danger">Reset</button>
              </div>
            </div>
          </div>
        </div>


          <!-- Table with trades for date selected in heatmap -->
          <div class="selected-trades" id="selected-trades">
            <h5 class="mt-5" id="selected-date"></h5>
            <table class= "table table-hover table-sm mt-3">
              <thead>
                <tr>
                  <th scope="col">Transaction Date</th>
                  <th scope="col">Senator</th>
                  <th scope="col">Owner</th>
                  <th scope="col">Ticker</th>
                  <th scope="col">Asset Name</th>
                  <th scope="col">Asset Type</th>
                  <th scope="col">Transaction Type</th>
                  <th scope="col">Amount</th>
                  <th scope="col">Comments</th>
                  <th scope="col">Original URL</th>
                </tr>
              </thead>
              <tbody id="selected-trades-table">
              </tbody>
            </table>
            <div id = "no-selected-trades-alert" class="alert alert-danger animated" role="alert">No date selected.</div>
          </div>
        </div>
        <script src='{% static 'js/asset_detail.js' %}'></script>
        <script>document.getElementById("overview-tab").addEventListener('click', () => createGraph(JSON.parse('{{ stock_history|escapejs }}'),JSON.parse('{{ json_trades|escapejs }}')),{ once:true })</script>

        <!-- All Trades tab -->
        <div class="tab-pane fade" id="trades" role="tabpanel" aria-labelledby="trades-tab">

          <!-- Options to filter trades -->
          <div class="mt-3 p-3 border light contrast-box">
            <div class="row mx-3">
              <div class="col-3">
                <div id="dateRange" class="input-group input-group-sm">
                  <input type="text" id="dateStartInput" class="form-control form-control-sm" placeholder="Start" aria-label="search start date">
                  <span class="input-group-text" id="dateInputLabel">to</span>
                  <input type="text" id="dateEndInput" class="form-control form-control-sm" placeholder="End" aria-label="search end date">
                </div>
                <script>makeDatePicker("dateRange")</script>
              </div>
              <!-- <div class="col-2"> -->
              <!--   <div class="input-group input-group-sm"> -->
              <!--     <span class="input-group-text" id="tickerInputLabel">Ticker</span> -->
              <!--     <input type="text" id="ticker" class="form-control form-control-sm" placeholder="All" aria-label="ticker search"> -->
              <!--   </div> -->
              <!-- </div> -->
              <!-- <div class="col"> -->
              <!--   <div class="input-group input-group-sm"> -->
              <!--     <span class="input-group-text" id="assetNameInputLabel">Asset Name</span> -->
              <!--     <input type="text" id="asset_name" class="form-control form-control-sm w-auto" placeholder="All" aria-label="asset name search"> -->
              <!--   </div> -->
              <!-- </div> -->
              <!-- <div class="col-2"> -->
              <!--   <div class="form-floating"> -->
              <!--     <select id="owner" class="form-select form-select-sm w-auto" aria-label="Owner select"> -->
              <!--       <option value="All" selected>All</option> -->
              <!--       <option value="Self">Self</option> -->
              <!--       <option value="Spouse">Spouse</option> -->
              <!--       <option value="Child">Child</option> -->
              <!--     </select> -->
              <!--     <label for="owner">Owner</label> -->
              <!--   </div> -->
              <!-- </div> -->
              <div class="col-2">
                <div class="form-floating">
                  <select class="form-select form-select-sm w-auto" id="asset_type" aria-label="asset type select">
                    <option value="All" selected>All</option>
                    <option value="Stock">Stock</option>
                    <option value="Non-Public Stock">Non-Public Stock</option>
                    <option value="Stock Option">Stock Option</option>
                    <option value="Corporate Bond">Corporate Bond</option>
                    <option value="Municipal Security">Municipal Security</option>
                    <option value="Other Securities">Other Securities</option>
                  </select>
                  <label for="asset_type">Asset Type</label>
                </div>
              </div>
              <div class="col-2">
                <div class="form-floating">
                  <select class="form-select form-select-sm w-auto" id="transaction_type" aria-label="transaction type select">
                    <option value="All" selected>All</option>
                    <option value="Purchase" selected>Purchase</option>
                    <option value="Sale (Partial)">Sale (Partial)</option>
                    <option value="Sale (Full)">Sale (Full)</option>
                  </select>
                  <label for="transaction_type">Transaction Type</label>
                </div>
              </div>
              <div class="col-3">
                <div class="form-floating">
                  <select class="form-select form-select-sm w-auto" id="amount" aria-label"trade amount select">
                    <option value="All" selected>All</option>
                    <option value="$1,001 - $15,000">$1,001 - $15,000</option>
                    <option value="$15,001 - $50,000">$15,001 - $50,000</option>							
                    <option value="$50,000 - $100,000">$50,000 - $100,000</option>
                    <option value="$100,001 - $250,000">$100,001 - $250,000</option>
                    <option value="$251,001 - $500,000">$251,001 - $500,000</option>
                    <option value="$500,001 - $1,000,000">$500,001 - $1,000,000</option>
                    <option value="$1,000,001 - 5,000,000">$1,000,001 - 5,000,000</option>
                    <option value="$5,000,001 - $25,000,000">$5,000,001 - $25,000,000</option>
                    <option value="$25,000,001 - $50,000,000">$25,000,001 - $50,000,000</option>
                    <option value="Over $50,000,0000">Over $50,000,000</option>
                  </select>
                  <label for="amount">Transaction Amount</label>
                </div>
              </div>
              <div class="col-2">
                <!-- <button onclick="displaySenatorResults()" type="button" class="btn btn-primary">Filter</button> -->
                <button id="reset-button" type="button" class="btn btn-danger">Reset</button>
              </div>
            </div>
          </div>
          <table class= "table table-hover table-striped table-sm mt-3">
            <thead>
              <tr>
                <th scope="col">All Transaction Dates</th>
                <th scope="col">Senator</th>
                <th scope="col">Owner</th>
                <th scope="col">Ticker</th>
                <th scope="col">Asset Name</th>
                <th scope="col">Asset Type</th>
                <th scope="col">Transaction Type</th>
                <th scope="col">Amount</th>
                <th scope="col">Comments</th>
                <th scope="col">Original URL</th>
              </tr>
            </thead>
            <tbody id="allTrades">
              <!-- {% for trade in trades %} -->
              <!-- <tr> -->
              <!--   <th scope="row">{{ trade.transaction_date }}</th> -->
              <!--   <td><a href={% url 'senator_detail' trade.senator.id %}>{{ trade.senator }}</a></td> -->
              <!--   <td>{{ trade.owner }}</td> -->
              <!--   <td>{{ trade.ticker }}</td> -->
              <!--   <td><a href="/asset/{{ trade.asset.id }}">{{ trade.asset_name }}</a></td> -->
              <!--   <td>{{ trade.asset_type }}</td> -->
              <!--   <td>{{ trade.transaction_type }}</td> -->
              <!--   <td>{{ trade.amount }}</td> -->
              <!--   <td>{{ trade.comments }}</td> -->
              <!--   <td><a href={{ trade.url }}>Link</a></td> -->
              <!-- </tr> -->
              <!-- {% endfor %} -->
            </tbody>
          </table>
          <div id="no-filter-trades-alert" style="visibility:hidden;display:none;" class="alert alert-dark animated" role="alert" >No trades found.</div>
          <div class="d-grid ">
            <button id="all-trades-more" class="btn btn-outline-primary btn-sm" type="button">Show More Trades</button>
          </div>
        </div>
      </div>

  </div>

  {% endblock content %}
